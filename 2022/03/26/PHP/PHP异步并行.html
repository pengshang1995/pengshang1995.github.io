<hr>
<p>title: PHP异步并行<br>date: 2018-02-01 10:33:59<br>tags:</p>
<hr>
<h2 id="一个PHP-Web程序的执行过程"><a href="#一个PHP-Web程序的执行过程" class="headerlink" title="一个PHP Web程序的执行过程"></a>一个PHP Web程序的执行过程</h2><ol>
<li>请求开始 (GET&#x2F;Post&#x2F;Cookie&#x2F;Session)</li>
<li>Mysql数据库查询&#x2F;Redis查询</li>
<li>模板渲染输出HTML&#x2F;json_encode</li>
<li>请求结束(回收所有内存和资源)</li>
</ol>
<h2 id="PHP-FPM进程的完整流程"><a href="#PHP-FPM进程的完整流程" class="headerlink" title="PHP-FPM进程的完整流程"></a>PHP-FPM进程的完整流程</h2><ol>
<li>请求1 处理请求 发送响应</li>
<li>请求2 处理请求 发送响应</li>
<li>请求3 处理请求 发送响应</li>
<li>。。。。</li>
</ol>
<p>Accept-&gt;Recv(处理)-&gt;Send-&gt;Close-&gt;Accept-&gt;Recv-&gt;Send-&gt;Close</p>
<h3 id="多进程并发地处理请求"><a href="#多进程并发地处理请求" class="headerlink" title="多进程并发地处理请求"></a>多进程并发地处理请求</h3><ul>
<li>进程1 请求1-&gt;请求2-&gt;……-&gt;请求N</li>
<li>进程2</li>
<li>进程3</li>
<li>…</li>
<li>进程N</li>
</ul>
<h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><ol>
<li>stream</li>
<li>sockets</li>
<li>libevent&#x2F;event</li>
<li>pcntl&#x2F;posix</li>
<li>pthread</li>
<li>sysvsem&#x2F;sysvmsg</li>
<li>shmop&#x2F;sysvshm</li>
</ol>
<h2 id="PHP同步阻塞"><a href="#PHP同步阻塞" class="headerlink" title="PHP同步阻塞"></a>PHP同步阻塞</h2><pre><code>$serv = stream_socket_server(&quot;tcp://0.0.0.0:8000&quot;,$errno,$errstr) or die (&quot;服务创建失败&quot;);

for ($i=0; $i&lt;32 ;$i++) {
    if (pcntl_fork() == 0) {
        while(1) {
            $conn = stream_socket_accept($serv);
            $request = fread($conn);
            $response = &quot;Hello 异步并行&quot;;
            fwrite($response);
            fclose($conn);    
        }
        exit(0);
    }
}
</code></pre>
